/*!
 * Field Drop Js v0.0.1-beta2 (August 29th 2017)
 * FieldDrop.js is an JavaScript library that provides drag and drop file uploads with image previews
 * 
 * https://github.com/dejaneves/fieldDrop.js#readme
 * 
 * Licensed MIT Â© Jaime Neves
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).FieldDrop=e()}}(function(){return function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return i(n||e)},d,d.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){function o(){}o.prototype={on:function(e,t,n){var o=this.e||(this.e={});return(o[e]||(o[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function o(){i.off(e,o),t.apply(n,arguments)}var i=this;return o._=t,this.on(e,o,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),o=0,i=n.length;for(o;o<i;o++)n[o].fn.apply(n[o].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),o=n[e],i=[];if(o&&t)for(var r=0,s=o.length;r<s;r++)o[r].fn!==t&&o[r].fn._!==t&&i.push(o[r]);
// Remove event from queue to prevent memory leak
// Suggested by https://github.com/lazd
// Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910
return i.length?n[e]=i:delete n[e],this}},t.exports=o},{}],2:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(){function e(t){o(this,e),this.defaults={json:!1},"object"===(void 0===t?"undefined":i(t))?this.options=Object.assign({},this.defaults,t):this.options=this.defaults}return r(e,[{key:"get",value:function(e,t){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n.open("GET",e),n.onreadystatechange=function(){n.readyState>3&&200===n.status&&t(n.responseText)},n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(),n}},{key:"post",value:function(e,t,n){"string"==typeof t||Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return o.open("POST",e),o.onreadystatechange=function(){o.readyState>3&&200===o.status&&n(o.responseText)},o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(t),o}},{key:"upload",value:function(e,t,n){var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=document.querySelector("progress"),r=this.options;return o.open("POST",e),o.onreadystatechange=function(){n(o.readyState>3&&200===o.status?r.json?JSON.parse(o.responseText):o.responseText:o)},o.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;i.value=i.innerHTML=t}},o.onload=function(){i.value=i.innerHTML=100},o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send(t),o}}]),e}();n.default=s},{}],3:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=o(e("./ajax")),d=o(e("tiny-emitter")),c=function(e){function t(e,n){i(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));
// Element
return o.element=e||null,o.trigger=null,o.defaults={url:"",JSONResponse:!1,selector:'input[type="file"]',eventListener:"change",deleteOptions:{htmlText:"Delete"}},o.divItems=document.createElement("div"),o.divProgress=document.createElement("progress"),o.fieldDrop_content=".field-drop--content",o.fieldDrop_uploads=".field-drop--uploads","string"==typeof o.element&&(o.element=document.querySelector(o.element)),"object"===(void 0===n?"undefined":a(n))?o.options=Object.assign({},o.defaults,n):o.options=o.defaults,o.element&&(o.mountTemplate(o.element),o.bindEvent()),o}return s(t,d.default),u(t,[{key:"createActionDelete",value:function(e,t){this.emit("delete",e,t)}},{key:"createActionSend",value:function(e){this.emit("send",e)}},{key:"setAttrItem",value:function(e,t){var n="div[data-name='"+e+"']";document.querySelector(n).setAttribute("data-response",t)}},{key:"mountTemplate",value:function(e){var t=document.createElement("div"),n=document.createElement("div");
// Div Contents
t.setAttribute("class",this.fieldDrop_content.replace(".","")),t.innerHTML='<div class="drag-and-drop-info"><span class="title">Drop files here</span><span class="icon"></span></div><input type="button" id="fake-button" onclick="document.getElementById(\'file-input\').click();" value="Select File ..."> <input type="file" name="file" id="file-input" style="display:none">',
// Div Uploads
n.setAttribute("class",this.fieldDrop_uploads.replace(".","")),
// Div Progress
this.divProgress.setAttribute("id","upload-progress"),this.divProgress.setAttribute("min",0),this.divProgress.setAttribute("max",100),this.divProgress.setAttribute("value",0),this.divProgress.setAttribute("class","hide"),this.divProgress.innerHTML="0",
// render
e.appendChild(t),e.appendChild(n),
//element.appendChild(this.divProgress);
// Get Element
this.trigger=e.querySelector(this.options.selector)}},{key:"EventDelete",value:function(){var e=this;this.element.querySelector(".field-drop--uploads .uploads__item .delete").addEventListener("click",function(t){t.preventDefault();var n=t.target.parentNode.parentNode.parentNode;n.remove();var o=n.getAttribute("data-name"),i=n.getAttribute("data-response");e.element.querySelector(e.fieldDrop_content).classList.remove("hide"),e.createActionDelete(o,i)})}},{key:"bindEvent",value:function(){var e=this,t=this.element;this.trigger.addEventListener("change",function(t){e.workPhoto(t.target.files)}),
// Events
// Drag and Drop
this.element.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),t.classList.add("selected-area")},!1),this.element.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t.classList.add("selected-area")},!1),this.element.addEventListener("dragend",function(e){t.classList.remove("selected-area")},!1),this.element.addEventListener("dragleave",function(e){t.classList.remove("selected-area")},!1),this.element.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault(),e.workPhoto(t.dataTransfer.files)},!1)}},{key:"workPhoto",value:function(e){this.renderPhoto(e)}},{key:"renderPhoto",value:function(e){var t=/image.*/,n=new FileReader,o=new Image,i=this.element.querySelector(this.fieldDrop_uploads),r=this.humanFileSize(e[0].size),s=this;this.divItems.setAttribute("class","uploads__item"),this.divItems.setAttribute("data-name",e[0].name);var a='<div class="item--image"></div><div class="item--info"><div class="info--name">'+e[0].name+'</div><div class="info--size">'+r+'</div><div class="info--actions"> <a href="#" class="delete" title="Delete"> '+this.options.deleteOptions.htmlText+" </a> </div></div>";this.divItems.innerHTML="",this.divItems.innerHTML=a,e[0].type.match(t)&&(n.onload=function(t){o.src=n.result,s.divItems.querySelector(".item--image").innerHTML="",s.divItems.querySelector(".item--image").appendChild(o),
// Uploads
i.appendChild(s.divItems),s.EventDelete(),s.createActionSend(e)}),n.readAsDataURL(e[0]),this.hideContenContainer()}},{key:"hideContenContainer",value:function(){this.element.querySelector(this.fieldDrop_content).classList.add("hide")}},{key:"sendFile",value:function(e,t){(this.options.JSONResponse?new l.default({json:!0}):new l.default).upload(this.options.url,e,function(e){t(e)})}},{key:"humanFileSize",value:function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}}]),t}();t.exports=c},{"./ajax":2,"tiny-emitter":1}]},{},[3])(3)});